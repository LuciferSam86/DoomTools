<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project>
<!-- ====================================================================== 
     Doom Struct Build File    
     Matt Tropiano                                                                
     ====================================================================== -->
<project name="build" default="compile">

	<description>Doom Struct</description>

	<property file="build.properties" />

	<!-- Dependencies -->
	<property name="dev.base" value=".." />
	<property name="S" value="${path.separator}" />
	<property name="shell.dir" value="shell" />

	<!-- Project Libs -->
	<property name="doom.lib.version" value="2.3.0" />
	<property name="doom.tag" value="${doom.lib.version}-RELEASE" />
	<property name="doom.project" value="doomstruct-${doom.lib.version}" />	
	<property name="doom.jar" value="${doom.project}.jar" />
	<property name="doom.jar.src" value="${doom.project}-sources.jar" />
	
	<!-- Project Info -->
	<property name="project.archive" value="wadtools" />
	<property name="project.javadoc.title" value="WadTools" />
	<property name="project.classpath" value="${dev.base}/${doom.jar}"/>
	<property name="project.compiler.bootclasspath" value="" />
	<property name="project.testclass" value=""/>
	<property name="project.testclass.main" value=""/>
	<property name="project.javadoc.packages" value="
		"
	/>
	
	<import file="build-dependencies.xml" />
	<import file="build-import.xml" />

	<macrodef name="shell">
		<attribute name="name" />
		<attribute name="todir" default="." />
		<attribute name="jarname" />
		<attribute name="mainclass" />
		<attribute name="options" default="" />
		<sequential>
			<copy file="${shell.dir}/compile/app-name.cmd" tofile="@{todir}/@{name}.cmd" />
			<replace file="@{todir}/@{name}.cmd" token="{{JAVA_OPTIONS}}" value="@{options}" />
			<replace file="@{todir}/@{name}.cmd" token="{{JAR_NAME}}" value="@{jarname}" />
			<replace file="@{todir}/@{name}.cmd" token="{{MAIN_CLASSNAME}}" value="@{mainclass}" />

			<copy file="${shell.dir}/compile/app-name.sh" tofile="@{todir}/@{name}" />
			<replace file="@{todir}/@{name}" token="{{JAVA_OPTIONS}}" value="@{options}" />
			<replace file="@{todir}/@{name}" token="{{JAR_NAME}}" value="@{jarname}" />
			<replace file="@{todir}/@{name}" token="{{MAIN_CLASSNAME}}" value="@{mainclass}" />
			
			<chmod file="./@{name}" perm="ugo+rx"/>
		</sequential>
	</macrodef>
	
	<target name="javadoc" depends="init.docs" description="Builds the documentation.">
        <javadoc access="protected" 
        	additionalparam="-J-Xmx512m  " author="true" 
        	classpath="${project.classpath}${path.separator}${bin.dir}" 
        	doctitle="${project.javadoc.title}" 
        	sourcepath="${src.dir}" 
        	packagenames="${project.javadoc.packages}"
        	destdir="${docs.dir}" 
        	splitindex="true" 
        	use="true" 
        	version="true" 
        	nodeprecated="false" 
        	nodeprecatedlist="false" 
        	noindex="false" 
        	nonavbar="false" 
        	notree="false"
    		>
            <link href="https://docs.oracle.com/en/java/javase/11/docs/api/"/>
        </javadoc>
    </target>	

	<target name="jar.one" depends="compile">
		<copy file="${dependencies.dir}/${doom.jar}" tofile="${jar.dir}/${jar.filename}" />
		<jar basedir="${bin.dir}" destfile="${jar.dir}/${jar.filename}" update="true" />
	</target>

	<target name="dependency.doom">
		<github-dl repository="MTrop/DoomStruct" tag="${doom.tag}" file="${doom.jar}" dest="${dependencies.dir}" />
		<github-dl repository="MTrop/DoomStruct" tag="${doom.tag}" file="${doom.jar.src}" dest="${dependencies.dir}" />
	</target>
	
	<target name="dependencies" depends="init.dependencies, dependency.doom, dependency.properties" description="Downloads and compiles the dependencies.">
	</target>

	<target name="release" depends="imported.release, jar.one" description="Zips together the application and shell scripts.">
		<!--<shell name="wadmerge" todir="${build.dir}/shell" jarname="${jar.dir}/${jar.filename}" />-->
	</target>

</project>