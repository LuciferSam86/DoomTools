
function eqlbuf(bufa, bufb)
{
	len = length(bufa);
	i = 0;
	while (i < len)
	{
		if (bufa->bufgetbyte(i) != bufb->bufgetbyte(i))
		{
			println(bufa);
			println(bufb);
			return error("Failure", "NOT EQUAL at byte " + i);
		}
		i += 1;
	}
	return true;  
}

check entry main(args)
{
	wad = wadfile(args[0]);
	
	println("THINGS");
	buf = waddata(wad, "things", args[1]);
	outbuf = bufnew(length(buf));
	in = bisopen(buf); out = bosopen(outbuf);
	while (bufgetpos(buf) < length(buf))
	{
		x = in->map::readhexenthing();
		println(x);
		out->map::writehexenthing(x);
	}
	eqlbuf(buf, outbuf);
	close([in, out]);
	
	println("VERTICES");
	buf = waddata(wad, "vertexes", args[1]);
	outbuf = bufnew(length(buf));
	in = bisopen(buf); out = bosopen(outbuf);
	while (bufgetpos(buf) < length(buf))
	{
		x = in->map::readvertex();
		println(x);
		out->map::writevertex(x);
	}
	eqlbuf(buf, outbuf);
	close([in, out]);

	println("LINEDEFS");
	buf = waddata(wad, "linedefs", args[1]);
	outbuf = bufnew(length(buf));
	in = bisopen(buf); out = bosopen(outbuf);
	while (bufgetpos(buf) < length(buf))
	{
		x = in->map::readhexenlinedef();
		println(x);
		out->map::writehexenlinedef(x);
	}
	eqlbuf(buf, outbuf);
	close([in, out]);

	println("SECTORS");
	buf = waddata(wad, "sectors", args[1]);
	outbuf = bufnew(length(buf));
	in = bisopen(buf); out = bosopen(outbuf);
	while (bufgetpos(buf) < length(buf))
	{
		x = in->map::readsector();
		println(x);
		out->map::writesector(x);
	}
	eqlbuf(buf, outbuf);
	close([in, out]);

	println("SIDEDEFS");
	buf = waddata(wad, "sidedefs", args[1]);
	outbuf = bufnew(length(buf));
	in = bisopen(buf); out = bosopen(outbuf);
	while (bufgetpos(buf) < length(buf))
	{
		x = in->map::readsidedef();
		println(x);
		out->map::writesidedef(x);
	}
	eqlbuf(buf, outbuf);
	close([in, out]);

	close(wad);
}